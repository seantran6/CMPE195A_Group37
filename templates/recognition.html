<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Age and Gender Recognition (Live Feed)</title>
  <link rel="stylesheet" href="../static/style.css" />

  <style>
    /* In case this isn't in your style.css yet */
    .hidden {
      display: none;
    }

    .fade-in {
      animation: fadeIn 0.5s ease-in-out forwards;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>

<body>
  <header>
    <nav class="navbar">
      <a href="{{ url_for('home') }}" class="nav-logo">
        <h1 class="logo-text">Title</h1>
      </a>
      <ul class="nav-menu">
        <li class="nav-item"><a href="{{ url_for('home') }}" class="nav-link">Home</a></li>
        <li class="nav-item"><a href="{{ url_for('recognition') }}" class="nav-link">Recognition</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Login</a></li>
      </ul>
    </nav>
  </header>

  <div class="container">
    <!-- Webcam feed -->
    <div class="video-container">
      <video id="webcam" autoplay playsinline width="640" height="480"></video>
    </div>

    <!-- Button -->
    <button id="capture-btn">Capture Frame</button>

    <!-- Results -->
    <div id="result">
      <p id="gender">Gender: </p>
      <p id="age">Age: </p>
    </div>
  </div>

  <!-- Recommendation section -->
  <div id="recommendations" class="hidden" style="margin: 150px auto 50px; text-align: center; min-height: 600px;">

    <h2>Recommended Songs</h2>
    <p>Recommendations will go here...</p>
  </div>

  <!-- Script -->
  <script>
    const video = document.getElementById('webcam');
    const captureBtn = document.getElementById('capture-btn');
    const genderOutput = document.getElementById('gender');
    const ageOutput = document.getElementById('age');

    async function startWebcam() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
        console.log('Webcam is running');
      } catch (error) {
        console.error('Error accessing webcam:', error);
        alert('Error accessing webcam. Please check your device settings.');
      }
    }

    async function captureFrame() {
      console.log('Capture frame button clicked');
      const canvas = document.createElement('canvas');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;

      const context = canvas.getContext('2d');
      context.drawImage(video, 0, 0, canvas.width, canvas.height);

      const imageData = canvas.toDataURL('image/jpeg');

      try {
        const response = await fetch('/recognize', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ image: imageData })
        });

        const result = await response.json();
        console.log('Received response from server:', result);

        genderOutput.textContent = `Gender: ${result.gender}`;
        ageOutput.textContent = `Age: ${result.age}`;

        // Reveal the recommendations section
        const recommendationsSection = document.getElementById('recommendations');
        recommendationsSection.classList.remove('hidden');
        recommendationsSection.classList.add('fade-in');

        // Smooth scroll to the recommendations section
        recommendationsSection.scrollIntoView({ behavior: 'smooth' });

      } catch (error) {
        console.error('Error sending frame to server:', error);
      }
    }

    captureBtn.addEventListener('click', captureFrame);

    // Start webcam on load
    startWebcam();
  </script>
</body>
</html>


